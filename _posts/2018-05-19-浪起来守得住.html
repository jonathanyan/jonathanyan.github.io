<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
</head>
<body>
<p>浪起来 守得住</p>

<p>给比特币加智能合同 之五</p>

<p>人不浪，生活乏味。一直浪，生活没了。</p>

<p>智能合同语言solidity，天生浪，脚本式的，一看就懂，下笔就有。当初V神要打市场，不浪不足以吸引眼球。可现在眼球盯着，丑态毕露…… 一个漏洞让几十亿打水漂。</p>

<p>当新的智能合同发布时，攻城狮的心里忐忑不安，不停地追问：安全吗？足够安全吗？ 足够足够安全吗？千百回的追寻换不来一句保证。哪有花花公子真心海誓山盟的。</p>

<p>好了，智能合同的语言难在哪？难在她太新，已有的语言都满足不了她。区块链的信任机制让软件必须开源，都公开了，就要完美无暇。没有维纳斯的身材，还赤裸裸，等着找骂呢！</p>

<p>一般的，计算机语言分成两大类，一种是为机器准备的，以汇编语言和C为代表，另一种是为人定制的，时下风靡的JavaScript，python， ruby都是此类。而java和C#属于骑墙派，在人与机器之间摇摆。</p>

<p>在人和机器之外，区块链呼唤第三类语言，为安全而生的。这种语言或许有，但不在大众视野中。中国国防部门有安全级别要求极高的OS，美国NASA也有自己设计的错误零容忍系统。这些都是专用项目，我们看不到。</p>

<p>那如何设计一个面向安全的语言，能让广大群众喜闻乐见，踊跃打call呢？答案是西门庆同学诠释的五字真言：潘驴邓小闲。</p>

<p>一张图说清楚一个语言，起个名字，叫BS语言 （Bit Safe Language)。边看附图，边念五字经。</p>

<img src="/resources/images/img0519.png">

<p>潘，潘安的貌，漂亮。语言是给人用的，第一眼看上去，让人有想用的冲动。太数学，太工程都不行。对写合同的人来说，凭common sense能看懂。懂了就会写，写了一定对。对应到语言中，高度抽象出lego式的protocol接口，搬搬lego块组装出合同。这个设计借鉴了solidity中的ERC20协议。BS把protocol上升到关键字，成为高层抽象接口。</p>

<p>驴，嗨嗨，功能强大。足够丰富的表述性，简单不意味功能简化。这方面go语言做了一个好榜样，array + map + struct + interface + function的组合能覆盖现代语言的90%表述场景。使用语言的人层次不同，BS以protocol分界，其上是合同，非工程师的业务人员能够掌握，其下是底层协议的编写，要求专业一些的码工，这项工作可以扔给开源社区。</p>

<p>邓，有钱，语言有价值。“钱”是重要指标，“邓”在五字真经中位于中间位置，重中之重。BS的价值是安全性。在语言层面，没有exception处理，但每一步都内嵌安全检测，数组越界，整数overflow，循环太多，BS自动了结自己，回滚到初始状态，跟SQL一样：要么不做，要么100分。对，你没看错，循环是有限制的，BS只支持有限图灵完备。因为现实的合同循环太多，肯定是错了，不是设计疏漏，就是编码bug。图灵完备是理论，有限图灵完备是真实的工程场景。</p>

<p>小，放得下身段，不出风头。一方面，数据类型极其简单，只有int（整数）一种，最小8 bits， 最大256 bits。万物皆比特。其他的，如字符串，可以用int8的array表示。至于双字节，unicode啥的，那是表现层的事，扔给类似web3的外部包装中。另一方面，数据组织简化，统一管理。数据private，写合同的看不到protocol里面的数。数据分成两种，stateful和stateless，以类似cobol语言的方式放在protocol头部。stateful数据将加到状态树中，让合同的状态能够延续。</p>

<p>闲，有时间，能做似乎无关痛痒的事。语言在编译时完成算法复杂度分析，智能合同的gas是钱，真的钱。写程序的人在写下每一行时，都要知道背后花掉多少钱。钱再多，也不能无休止地浪，对不？！</p>

<p>面向安全，安全第一，这是BS语言设计的宗旨。让写程序的人有信心，让用合同的人能放心。</p>

<p>仍然可以浪。但守得住底线，无懈可击。</p>

<p>博客收录于 https://jonathanyan.github.io</p>

</body>
</html>